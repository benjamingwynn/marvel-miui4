echo "patching Settings, SystemUI and Framework-res"
echo "for apktool to work, get apks 2 to 5. You can find them on github.com/miui"
scripts/press_enter
echo "installing apktool stuff"
cd /
mv Volumes/Cooking/Temporary-new/framework-res.apk Users/Developer/apktool/framework/1.apk
mv Volumes/Cooking/Temporary-new/framework-miui-res.apk Users/Developer/apktool/framework/6.apk
cd /Volumes/Cooking/Temporary-new
apktool d Settings.apk
apktool d framework-res.apk
apktool d miuisystemui.apk
echo "fixing bools"
cd /Volumes/Cooking/Temporary-new/framework-res/res/values
cat bools.xml | sed -e 's/skip_restoring_network_selection">true/skip_restoring_network_selection">false/' > bools.xml
cat bools.xml | sed -e 's/bluetooth_adapter_quick_switch">true/bluetooth_adapter_quick_switch">false/' > bools.xml
cat bools.xml | sed -e 's/bluetooth_wide_band_speech">false/bluetooth_wide_band_speech">true/' > bools.xml
cat bools.xml | sed -e 's/unplugTurnsOnScreen">true/unplugTurnsOnScreen">false/' > bools.xml
cat bools.xml | sed -e 's/ui_enableFadingMarquee">false/ui_enableFadingMarquee">true/' > bools.xml
cat bools.xml | sed -e 's/allowAllRotations">false/allowAllRotations">true/' > bools.xml
echo "fixing arrays"
cat arrays.xml | sed -e 's/rndis0/usb0/' > arrays.xml
cat arrays.xml | sed -e 's/bluetooth,7,7/wifi_p2p,13,1/' > arrays.xml
echo "manually fix light sensor values"
echo "config_autoBrightnessLcdBacklightValues: 25, 45, 65, 85, 105, 125"
echo "config_autoBrightnessButtonBacklightValues: 1, 0, 0, 0, 0, 0"
echo "also add missing radio attributes and remove mobile_dun"
echo "<item>mobile_fota,10,0,2,60000,true</item>"
echo "<item>mobile_ims,11,0,2,60000,true</item>"
echo "<item>mobile_cbs,12,0,2,60000,true</item>"
open arrays.xml
scripts/press_enter
echo "add following string after wimax:"
echo "<string name="config_legacyUmsLunFile">/sys/devices/platform/usb_mass_storage/lun0/file</string>"
open strings.xml
scripts/press_enter
cd /Volumes/Cooking
cp MIUI-resources/storage_list.xml Temporary-new/framework-res/res/xml
cd /Volumes/Cooking/Temporary-new/miuisystemui/res/values
echo "remove the first line to remove the black bar"
open ...
scripts/press_enter
cd /Volumes/Cooking/Temporary-new/Settings/res/values
echo "fixing bools of settings"
cat bools.xml | sed -e 's/has_led">false/has_led">true/' > bools.xml
cat bools.xml | sed -e 's/has_multi_touch">false/has_multi_touch">true/' > bools.xml
echo "adding custom about logo"
cp MIUI-resources/miui_logo.9.png Temporary-new/Settings/res/drawable-hdpi
cp MIUI-resources/miui_logo.9.png Temporary-new/Settings/res/drawable-en-hdpi
cd /Volumes/Cooking/Temporary-new
apktool b Framework-res
apktool b Settings
apktool b SystemUI
zip -m Settings.apk Settings/build/apk/resources.arcs
zip -m SystemUI.apk SystemUI/build/apk/resources.arcs
zip -m Framework-res.apk Framework-res/build/apk/resources.arcs